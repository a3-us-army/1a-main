<!DOCTYPE html>
<html>
<head>
  <title><%= action %> Certification</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="icon" href="/favicon.ico">
  <link rel="stylesheet" href="/custom.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <style>
    .card-title i {
      color: #b68900;
    }
    @media (max-width: 600px) {
      .card {
        padding: 0.5rem;
        margin: 0 0.2rem;
      }
      .card-title {
        font-size: 1.2rem;
      }
      .form-label {
        font-size: 1rem;
      }
      .form-control {
        font-size: 1rem;
        padding: 0.6rem 0.7rem;
      }
    }
  </style>
</head>
<body>
  <%- include("partials/navbar", { user, active }) %>
  <div id="main-content">
    <div class="container mt-4">
      <% if (alert) { %>
        <div class="alert alert-success alert-dismissible fade show mt-3" role="alert">
          <%= alert %>
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
      <% } %>
      <% if (error) { %>
        <div class="alert alert-danger alert-dismissible fade show mt-3" role="alert">
          <%= error %>
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
      <% } %>
      <div class="row justify-content-center">
        <div class="col-12 col-sm-10 col-md-8 col-lg-6">
          <div class="card shadow-lg mx-auto">
            <div class="card-body p-3">
              <h2 class="card-title mb-3 text-center">
                <i class="bi bi-patch-check me-2"></i><%= action %> Certification
              </h2>
              <form method="POST" action="/certs/<%= cert ? 'edit/' + cert.id : 'new' %>" autocomplete="off">
                <div class="mb-3">
                  <label class="form-label" for="name">Certification Name</label>
                  <input type="text" id="name" name="name" class="form-control" required maxlength="100" placeholder="e.g. Combat Lifesaver" value="<%= cert ? cert.name : '' %>">
                </div>
                <div class="mb-3">
                  <label class="form-label" for="description">Description</label>
                  <textarea id="description" name="description" class="form-control" rows="3" placeholder="Describe the certification..."><%= cert ? cert.description : '' %></textarea>
                </div>
                <div class="mb-3">
                  <label class="form-label" for="category">Category</label>
                  <select id="category" name="category" class="form-control" required>
                    <option value="">Select a category</option>
                    <option value="160th Soar" <%= cert && cert.category === '160th Soar' ? 'selected' : '' %>>160th Soar</option>
                    <option value="Avteg" <%= cert && cert.category === 'Avteg' ? 'selected' : '' %>>Avteg</option>
                    <option value="Infantry" <%= cert && cert.category === 'Infantry' ? 'selected' : '' %>>Infantry</option>
                  </select>
                  <small class="form-text text-muted">Select the category this certification belongs to.</small>
                </div>
                <div class="mb-3">
                  <label class="form-label" for="required_mos">Required MOS</label>
                  <select id="required_mos" name="required_mos" class="form-control" multiple size="4" required>
                    <% if (availableRoles && availableRoles.length > 0) { %>
                      <% availableRoles.forEach(role => { %>
                        <option 
                            value="<%= role %>" 
                            <%= cert && cert.required_mos && (function() { 
                              try { 
                                const mosArray = JSON.parse(cert.required_mos); 
                                return Array.isArray(mosArray) && mosArray.includes(role); 
                              } catch(e) { 
                                return cert.required_mos === role; 
                              } 
                            }()) ? 'selected' : '' %>
                        >
                            <%= role %>
                        </option>
                      <% }) %>
                    <% } %>
                  </select>
                  <small class="form-text text-muted">Hold Ctrl (or Cmd on Mac) to select multiple MOS roles. You can select multiple roles if any of them qualify for this certification.</small>
                </div>
                <div class="d-flex justify-content-between align-items-center mt-3">
                  <button type="submit" class="btn btn-primary flex-grow-1 me-2">
                    <i class="bi bi-<%= cert ? 'check-circle' : 'plus-circle' %> me-1"></i><%= action %>
                  </button>
                  <a href="/certs" class="btn btn-outline-secondary ms-2">
                    <i class="bi bi-x-circle me-1"></i>Cancel
                  </a>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <%- include("partials/footer") %>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>