<!DOCTYPE html>
<html>
  <head>
    <title>Form Management - 1A 75th</title>
    <meta content="1A Website" property="og:title" />
    <meta content="Welcome to 1A!" property="og:description" />
    <meta content="https://1a75.org/admin/forms" property="og:url" />
    <meta content="https://cdn.xanderxx.xyz/1a-logo.png" property="og:image" />
    <meta content="#4b5a2a" data-react-helmet="true" name="theme-color" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css"
    />
    <link rel="icon" href="/favicon.ico" />
    <link rel="stylesheet" href="/custom.css" />
  </head>
  <body>
    <%- include('../partials/navbar', { user, active }) %>
    <div class="container mt-5">
      <div class="d-flex justify-content-between align-items-center mb-4">
      <h1 class="h2 mb-0">Form Management</h1>
      <div class="d-flex gap-2">
        <a href="/form-builder/builder" class="btn btn-primary">
          <i class="bi bi-plus-circle me-2"></i>Create New Form
        </a>
      </div>
    </div>

    <% if (alert) { %>
      <div class="alert alert-success alert-dismissible fade show" role="alert">
        <%= alert %>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      </div>
    <% } %>

    <% if (error) { %>
      <div class="alert alert-danger alert-dismissible fade show" role="alert">
        <%= error %>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      </div>
    <% } %>

      <!-- Form Templates -->
    <div class="card">
      <div class="card-header">
        <h5 class="card-title mb-0">Form Templates</h5>
      </div>
      <div class="card-body">
        <% if (templates.length > 0) { %>
          <div class="row">
            <% templates.forEach(template => { %>
              <div class="col-md-6 col-lg-4 mb-4">
                <div class="card h-100">
                  <div class="card-header d-flex justify-content-between align-items-start">
                    <h6 class="card-title mb-0"><%= template.name %></h6>
                    <span class="badge <%= template.is_active ? 'bg-success' : 'bg-secondary' %>">
                      <%= template.is_active ? 'Active' : 'Inactive' %>
                    </span>
                  </div>
                  <div class="card-body">
                    <% if (template.description) { %>
                      <p class="card-text text-muted mb-3"><%= template.description %></p>
                    <% } %>
                    
                    <!-- Analytics Summary -->
                    <div class="row text-center mb-3">
                      <div class="col-6">
                        <p class="h4 text-primary mb-0"><%= template.analytics.totalStarted %></p>
                        <small class="text-muted">Started</small>
                      </div>
                      <div class="col-6">
                        <p class="h4 text-success mb-0"><%= template.analytics.totalCompleted %></p>
                        <small class="text-muted">Completed</small>
                      </div>
                    </div>
                    
                    <div class="mb-3">
                      <div class="d-flex justify-content-between mb-1">
                        <small>Completion Rate</small>
                        <small><%= template.analytics.completionRate %>%</small>
                      </div>
                      <div class="progress" style="height: 6px;">
                        <div class="progress-bar bg-success" style="width: <%= template.analytics.completionRate %>%"></div>
                      </div>
                    </div>
                    
                    <div class="d-grid gap-2">
                      <a href="/form-builder/builder/<%= template.id %>" class="btn btn-sm btn-outline-primary">
                        <i class="bi bi-pencil me-1"></i>Edit
                      </a>
                      <a href="/form-builder/analytics/<%= template.id %>" class="btn btn-sm btn-outline-success">
                        <i class="bi bi-graph-up me-1"></i>Analytics
                      </a>
                      <a href="/form-builder/preview/<%= template.id %>" class="btn btn-sm btn-outline-info">
                        <i class="bi bi-eye me-1"></i>Preview
                      </a>
                      <form method="POST" action="/form-builder/delete/<%= template.id %>" class="d-inline" onsubmit="return confirm('Are you sure you want to delete this form?')">
                        <button type="submit" class="btn btn-sm btn-outline-danger w-100">
                          <i class="bi bi-trash me-1"></i>Delete
                        </button>
                      </form>
                    </div>
                  </div>
                  <div class="card-footer">
                    <div class="d-flex justify-content-between">
                      <small class="text-muted">Created: <%= new Date(template.created_at).toLocaleDateString() %></small>
                      <% if (template.updated_at) { %>
                        <small class="text-muted">Updated: <%= new Date(template.updated_at).toLocaleDateString() %></small>
                      <% } %>
                    </div>
                  </div>
                </div>
              </div>
            <% }) %>
          </div>
        <% } else { %>
          <div class="text-center py-5">
            <i class="bi bi-file-earmark-text text-muted" style="font-size: 3rem;"></i>
            <h5 class="mt-3">No forms created yet</h5>
            <p class="text-muted mb-4">Get started by creating your first form template</p>
            <a href="/form-builder/builder" class="btn btn-primary">
              <i class="bi bi-plus-circle me-2"></i>Create Your First Form
            </a>
          </div>
        <% } %>
      </div>
    </div>

  <!-- Quick Stats -->
  <% if (templates.length > 0) { %>
    <div class="mt-8 grid grid-cols-1 md:grid-cols-4 gap-6">
      <div class="bg-white p-6 rounded-lg shadow">
        <h3 class="text-lg font-semibold text-gray-900">Total Forms</h3>
        <p class="text-3xl font-bold text-blue-600"><%= templates.length %></p>
      </div>
      <div class="bg-white p-6 rounded-lg shadow">
        <h3 class="text-lg font-semibold text-gray-900">Active Forms</h3>
        <p class="text-3xl font-bold text-green-600"><%= templates.filter(t => t.is_active).length %></p>
      </div>
      <div class="bg-white p-6 rounded-lg shadow">
        <h3 class="text-lg font-semibold text-gray-900">Total Responses</h3>
        <p class="text-3xl font-bold text-purple-600">
          <%= templates.reduce((sum, t) => sum + t.analytics.totalCompleted, 0) %>
        </p>
      </div>
      <div class="bg-white p-6 rounded-lg shadow">
        <h3 class="text-lg font-semibold text-gray-900">Avg Completion</h3>
        <p class="text-3xl font-bold text-orange-600">
          <%= templates.length > 0 ? (templates.reduce((sum, t) => sum + parseFloat(t.analytics.completionRate), 0) / templates.length).toFixed(1) : 0 %>%
        </p>
      </div>
    </div>
  <% } %>
    </div>
    <%- include('../partials/footer') %>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html> 