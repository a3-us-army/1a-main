<!DOCTYPE html>
<html>
  <head>
    <title>Personal Finance - 1A 75th</title>
    <meta content="1A Website" property="og:title" />
    <meta content="Personal Finance Management" property="og:description" />
    <meta content="https://1a75.org/finance" property="og:url" />
    <meta content="https://cdn.xanderxx.xyz/1a-logo.png" property="og:image" />
    <meta content="#4b5a2a" data-react-helmet="true" name="theme-color" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css"
    />
    <link rel="icon" href="/favicon.ico" />
    <link rel="stylesheet" href="/custom.css" />
    <style>
      .finance-card {
        background: linear-gradient(135deg, rgba(30, 30, 40, 0.95) 0%, rgba(20, 20, 30, 0.9) 100%);
        border-radius: 16px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        border: 1px solid rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(20px);
      }
      
      .monthly-total-card {
        background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        color: white;
        border-radius: 16px;
        padding: 2rem;
        text-align: center;
        box-shadow: 0 8px 32px rgba(40, 167, 69, 0.3);
      }
      
      .item-card {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 12px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        transition: all 0.3s ease;
      }
      
      .item-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        border-color: rgba(255, 255, 255, 0.2);
      }
      
      .price-badge {
        background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
        color: white;
        padding: 0.5rem 1rem;
        border-radius: 20px;
        font-weight: 600;
      }
      
      .card-number {
        background: rgba(255, 255, 255, 0.1);
        padding: 0.25rem 0.5rem;
        border-radius: 6px;
        font-family: monospace;
        font-size: 0.9rem;
      }
      
      .btn-action {
        padding: 0.5rem 1rem;
        border-radius: 8px;
        font-size: 0.9rem;
        transition: all 0.3s ease;
      }
      
      .btn-action:hover {
        transform: translateY(-1px);
      }
      
      .modal-content {
        background: linear-gradient(135deg, rgba(30, 30, 40, 0.95) 0%, rgba(20, 20, 30, 0.9) 100%);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 16px;
        backdrop-filter: blur(20px);
      }
      
      .form-control, .form-select {
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        color: white;
        border-radius: 8px;
      }
      
      .form-control:focus, .form-select:focus {
        background: rgba(255, 255, 255, 0.1);
        border-color: #007bff;
        color: white;
        box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
      }
      
      .form-control::placeholder {
        color: rgba(255, 255, 255, 0.6);
      }
      
      .form-label {
        color: rgba(255, 255, 255, 0.9);
        font-weight: 600;
      }
    </style>
  </head>
  <body>
    <%- include('../partials/navbar', { user, active }) %>
    <div class="container mt-5">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="h2 mb-0 text-white">
          <i class="bi bi-wallet2 me-2"></i>Personal Finance
        </h1>
        <div class="d-flex gap-2">
          <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addItemModal">
            <i class="bi bi-plus-circle me-2"></i>Add Item
          </button>
        </div>
      </div>

      <% if (alert) { %>
        <div class="alert alert-success alert-dismissible fade show" role="alert">
          <%= alert %>
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
      <% } %>

      <% if (error) { %>
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
          <%= error %>
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
      <% } %>

      <!-- Monthly Total Card -->
      <div class="monthly-total-card mb-4">
        <h3 class="mb-2">
          <i class="bi bi-calendar-month me-2"></i>Monthly Total
        </h3>
        <h2 class="display-4 fw-bold mb-0">$<%= monthlyTotal.toFixed(2) %></h2>
        <p class="mb-0 opacity-75">Current month spending</p>
      </div>

      <!-- Finance Items -->
      <div class="finance-card">
        <div class="card-header bg-transparent border-bottom border-secondary">
          <h5 class="card-title mb-0 text-white">
            <i class="bi bi-list-ul me-2"></i>Finance Items
          </h5>
        </div>
        <div class="card-body">
          <% if (items.length > 0) { %>
            <div class="row">
              <% items.forEach(item => { %>
                <div class="col-md-6 col-lg-4 mb-4">
                  <div class="item-card p-3">
                    <div class="d-flex justify-content-between align-items-start mb-3">
                      <h6 class="card-title mb-0 text-white"><%= item.name %></h6>
                      <span class="price-badge">$<%= parseFloat(item.price).toFixed(2) %></span>
                    </div>
                    
                    <% if (item.description) { %>
                      <p class="card-text text-muted mb-3"><%= item.description %></p>
                    <% } %>
                    
                    <% if (item.card_last_four) { %>
                      <div class="mb-3">
                        <small class="text-muted">Card:</small>
                        <span class="card-number ms-2">****<%= item.card_last_four %></span>
                      </div>
                    <% } %>
                    
                    <div class="d-flex justify-content-between align-items-center">
                      <small class="text-muted">
                        <i class="bi bi-calendar3 me-1"></i>
                        <%= new Date(item.created_at).toLocaleDateString() %>
                      </small>
                      
                      <div class="btn-group" role="group">
                        <a href="/finance/edit/<%= item.id %>" class="btn btn-sm btn-outline-primary btn-action">
                          <i class="bi bi-pencil"></i>
                        </a>
                        <button type="button" class="btn btn-sm btn-outline-danger btn-action" 
                                onclick="confirmDelete(<%= item.id %>, '<%= item.name.replace(/'/g, "\\'") %>')">
                          <i class="bi bi-trash"></i>
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              <% }) %>
            </div>
          <% } else { %>
            <div class="text-center py-5">
              <i class="bi bi-wallet2 text-muted" style="font-size: 3rem;"></i>
              <h5 class="mt-3 text-white">No finance items yet</h5>
              <p class="text-muted mb-4">Start tracking your expenses by adding your first item</p>
              <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addItemModal">
                <i class="bi bi-plus-circle me-2"></i>Add Your First Item
              </button>
            </div>
          <% } %>
        </div>
      </div>
    </div>

    <!-- Add Item Modal -->
    <div class="modal fade" id="addItemModal" tabindex="-1" aria-labelledby="addItemModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header border-secondary">
            <h5 class="modal-title text-white" id="addItemModalLabel">
              <i class="bi bi-plus-circle me-2"></i>Add Finance Item
            </h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <form method="POST" action="/finance/add">
            <div class="modal-body">
              <div class="mb-3">
                <label for="name" class="form-label">Item Name *</label>
                <input type="text" class="form-control" id="name" name="name" required>
              </div>
              <div class="mb-3">
                <label for="description" class="form-label">Description</label>
                <textarea class="form-control" id="description" name="description" rows="3"></textarea>
              </div>
              <div class="mb-3">
                <label for="price" class="form-label">Price *</label>
                <div class="input-group">
                  <span class="input-group-text">$</span>
                  <input type="number" class="form-control" id="price" name="price" step="0.01" min="0" required>
                </div>
              </div>
              <div class="mb-3">
                <label for="card_last_four" class="form-label">Card Last 4 Digits</label>
                <input type="text" class="form-control" id="card_last_four" name="card_last_four" 
                       maxlength="4" pattern="[0-9]{4}" placeholder="1234">
              </div>
            </div>
            <div class="modal-footer border-secondary">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
              <button type="submit" class="btn btn-primary">
                <i class="bi bi-plus-circle me-2"></i>Add Item
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Delete Confirmation Form -->
    <form id="deleteForm" method="POST" style="display: none;">
      <input type="hidden" name="_method" value="DELETE">
    </form>

    <%- include('../partials/footer') %>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      function confirmDelete(itemId, itemName) {
        if (confirm(`Are you sure you want to delete "${itemName}"?`)) {
          const form = document.getElementById('deleteForm');
          form.action = `/finance/delete/${itemId}`;
          form.submit();
        }
      }
      
      // Auto-format card number input
      document.getElementById('card_last_four').addEventListener('input', function(e) {
        this.value = this.value.replace(/[^0-9]/g, '').slice(0, 4);
      });
    </script>
  </body>
</html>
