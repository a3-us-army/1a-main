<!DOCTYPE html>
<html>
  <head>
    <title><%= form.name %> - 1A 75th</title>
    <meta content="1A Website" property="og:title" />
    <meta content="Welcome to 1A!" property="og:description" />
    <meta content="https://1a75.org" property="og:url" />
    <meta content="https://cdn.xanderxx.xyz/1a-logo.png" property="og:image" />
    <meta content="#4b5a2a" data-react-helmet="true" name="theme-color" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css"
    />
    <link rel="icon" href="/favicon.ico" />
    <link rel="stylesheet" href="/custom.css" />
  </head>
  <body>
    <%- include('../partials/navbar', { user, active: null }) %>
    
    <div class="container mt-5">
      <div class="row justify-content-center">
        <div class="col-md-8">
          <!-- Form Header -->
          <div class="card mb-4">
            <div class="card-header">
              <h1 class="h3 mb-0"><%= form.name %></h1>
              <% if (form.description) { %>
                <p class="text-muted mb-0 mt-2"><%= form.description %></p>
              <% } %>
            </div>
          </div>

          <!-- Form Content -->
          <div class="card">
            <div class="card-body">
              <form id="public-form" data-form-id="<%= form.id %>">
                <input type="hidden" name="_startTime" value="<%= Date.now() %>">
                
                <% if (form.fields && form.fields.length > 0) { %>
                  <% form.fields.forEach((field, index) => { %>
                    <div class="mb-3">
                      <label for="field-<%= index %>" class="form-label">
                        <%= field.label %>
                        <% if (field.required) { %>
                          <span class="text-danger">*</span>
                        <% } %>
                      </label>
                      
                      <% if (field.type === 'text') { %>
                        <input 
                          type="text" 
                          class="form-control" 
                          id="field-<%= index %>" 
                          name="<%= field.name %>"
                          <% if (field.required) { %>required<% } %>
                          placeholder="Enter <%= field.label.toLowerCase() %>"
                        >
                      <% } else if (field.type === 'textarea') { %>
                        <textarea 
                          class="form-control" 
                          id="field-<%= index %>" 
                          name="<%= field.name %>"
                          rows="3"
                          <% if (field.required) { %>required<% } %>
                          placeholder="Enter <%= field.label.toLowerCase() %>"
                        ></textarea>
                      <% } else if (field.type === 'email') { %>
                        <input 
                          type="email" 
                          class="form-control" 
                          id="field-<%= index %>" 
                          name="<%= field.name %>"
                          <% if (field.required) { %>required<% } %>
                          placeholder="Enter email address"
                        >
                      <% } else if (field.type === 'number') { %>
                        <input 
                          type="number" 
                          class="form-control" 
                          id="field-<%= index %>" 
                          name="<%= field.name %>"
                          <% if (field.required) { %>required<% } %>
                          placeholder="Enter number"
                        >
                      <% } else if (field.type === 'select') { %>
                        <select 
                          class="form-select" 
                          id="field-<%= index %>" 
                          name="<%= field.name %>"
                          <% if (field.required) { %>required<% } %>
                        >
                          <option value="">Select an option</option>
                          <% if (field.options) { %>
                            <% field.options.forEach(option => { %>
                              <option value="<%= option %>"><%= option %></option>
                            <% }) %>
                          <% } %>
                        </select>
                      <% } else if (field.type === 'radio') { %>
                        <div>
                          <% if (field.options) { %>
                            <% field.options.forEach(option => { %>
                              <div class="form-check">
                                <input 
                                  class="form-check-input" 
                                  type="radio" 
                                  id="field-<%= index %>-<%= option.replace(/\s+/g, '-').toLowerCase() %>" 
                                  name="<%= field.name %>" 
                                  value="<%= option %>"
                                  <% if (field.required) { %>required<% } %>
                                >
                                <label class="form-check-label" for="field-<%= index %>-<%= option.replace(/\s+/g, '-').toLowerCase() %>">
                                  <%= option %>
                                </label>
                              </div>
                            <% }) %>
                          <% } %>
                        </div>
                      <% } else if (field.type === 'checkbox') { %>
                        <div>
                          <% if (field.options) { %>
                            <% field.options.forEach(option => { %>
                              <div class="form-check">
                                <input 
                                  class="form-check-input" 
                                  type="checkbox" 
                                  id="field-<%= index %>-<%= option.replace(/\s+/g, '-').toLowerCase() %>" 
                                  name="<%= field.name %>[]" 
                                  value="<%= option %>"
                                >
                                <label class="form-check-label" for="field-<%= index %>-<%= option.replace(/\s+/g, '-').toLowerCase() %>">
                                  <%= option %>
                                </label>
                              </div>
                            <% }) %>
                          <% } %>
                        </div>
                      <% } else if (field.type === 'date') { %>
                        <input 
                          type="date" 
                          class="form-control" 
                          id="field-<%= index %>" 
                          name="<%= field.name %>"
                          <% if (field.required) { %>required<% } %>
                        >
                      <% } else if (field.type === 'file') { %>
                        <input 
                          type="file" 
                          class="form-control" 
                          id="field-<%= index %>" 
                          name="<%= field.name %>"
                          <% if (field.required) { %>required<% } %>
                        >
                      <% } %>
                      
                      <% if (field.description) { %>
                        <div class="form-text"><%= field.description %></div>
                      <% } %>
                    </div>
                  <% }) %>
                <% } %>
                
                <div class="d-flex gap-2">
                  <button type="submit" class="btn btn-primary" id="submit-btn">
                    <i class="bi bi-check-circle me-2"></i>Submit Form
                  </button>
                  <button type="button" class="btn btn-outline-secondary" onclick="resetForm()">
                    <i class="bi bi-arrow-clockwise me-2"></i>Reset
                  </button>
                </div>
              </form>
            </div>
          </div>

          <!-- Success Message (hidden by default) -->
          <div class="card mt-4" id="success-message" style="display: none;">
            <div class="card-body text-center">
              <i class="bi bi-check-circle text-success" style="font-size: 3rem;"></i>
              <h4 class="mt-3" id="success-text">Thank you for your submission!</h4>
              <p class="text-muted">Your response has been recorded successfully.</p>
            </div>
          </div>

          <!-- Error Message (hidden by default) -->
          <div class="card mt-4" id="error-message" style="display: none;">
            <div class="card-body text-center">
              <i class="bi bi-exclamation-triangle text-danger" style="font-size: 3rem;"></i>
              <h4 class="mt-3" id="error-text">An error occurred</h4>
              <p class="text-muted" id="error-details">Please try again later.</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <%- include('../partials/footer') %>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      function resetForm() {
        document.getElementById('public-form').reset();
        hideMessages();
      }

      function hideMessages() {
        document.getElementById('success-message').style.display = 'none';
        document.getElementById('error-message').style.display = 'none';
      }

      function showSuccess(message) {
        document.getElementById('success-text').textContent = message;
        document.getElementById('success-message').style.display = 'block';
        document.getElementById('error-message').style.display = 'none';
        document.getElementById('public-form').style.display = 'none';
      }

      function showError(message, details = '') {
        document.getElementById('error-text').textContent = message;
        document.getElementById('error-details').textContent = details;
        document.getElementById('error-message').style.display = 'block';
        document.getElementById('success-message').style.display = 'none';
      }

      // Handle form submission
      document.getElementById('public-form').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const submitBtn = document.getElementById('submit-btn');
        const originalText = submitBtn.innerHTML;
        
        // Disable submit button and show loading
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<i class="bi bi-hourglass-split me-2"></i>Submitting...';
        
        try {
          const formData = new FormData(this);
          const data = {};
          for (let [key, value] of formData.entries()) {
            data[key] = value;
          }
          
          const formId = this.getAttribute('data-form-id');
          const response = await fetch(`/form/${formId}/submit`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(data)
          });
          
          const result = await response.json();
          
          if (response.ok && result.success) {
            showSuccess(result.message);
          } else {
            showError('Submission Failed', result.error || 'An error occurred while submitting the form.');
          }
        } catch (error) {
          console.error('Error submitting form:', error);
          showError('Network Error', 'Please check your connection and try again.');
        } finally {
          // Re-enable submit button
          submitBtn.disabled = false;
          submitBtn.innerHTML = originalText;
        }
      });
    </script>
  </body>
</html> 